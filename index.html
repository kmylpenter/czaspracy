<!DOCTYPE html><html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>Rejestracja czasu pracy</title>  <!-- Google API klient -->  <script src="https://apis.google.com/js/api.js" defer onload="gapiLoaded()"></script>  <!-- Google Identity Services -->  <script src="https://accounts.google.com/gsi/client" defer onload="gisLoaded()"></script>  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 0;
      background: #f9f9f9;
      color: #222;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    h2 {
      margin: 20px 0 0 0;
    }
    .screen {
      display: none;
      flex-direction: column;
      align-items: center;
      width: 100%;
    }
    .active {
      display: flex;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
      gap: 10px;
      margin: 20px;
      width: 90%;
      max-width: 800px;
    }
    .tile {
      background: #fff;
      color: #222;
      padding: 20px;
      text-align: center;
      border-radius: 10px;
      font-size: 1.1rem;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      cursor: pointer;
      transition: all 0.2s ease-in-out;
    }
    .tile:hover {
      background: #f0f0f0;
      transform: scale(1.05);
    }
    .tile.selected {
      background: #d0e8ff;
      border: 2px solid #3a84ff;
    }
    button {
      margin: 10px;
      padding: 10px 20px;
      font-size: 1.2rem;
      cursor: pointer;
      border: none;
      border-radius: 8px;
      background: #3a84ff;
      color: white;
      transition: background 0.2s;
    }
    button:hover {
      background: #5aa0ff;
    }
    .summary-entry {
      margin: 10px 0;
      padding: 10px;
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    .nav-bar {
      position: absolute;
      left: 10px;
      top: 10px;
    }
    .back-button {
      background: #e0e0e0;
      color: #333;
    }
    .back-button:hover {
      background: #d0d0d0;
    }
    .hour-options {
      display: grid;
      grid-template-columns: repeat(8, 1fr);
      gap: 10px;
      margin-top: 10px;
      width: 90%;
      max-width: 800px;
    }
    .summary-entry-container {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 16px;
      justify-content: center;
      max-width: 800px;
      margin: 20px auto;
    }
    .total-hours {
      font-size: 1.2rem;
      font-weight: bold;
      margin-left: 20px;
    }
    .total-hours.red {
      color: #d80000;
    }
    .total-hours.green {
      color: #006400;
    }
    .remove-btn {
      float: right;
      background: none;
      border: none;
      font-size: 1.2rem;
      color: #d80000;
      cursor: pointer;
      margin-top: -10px;
    }
    .remove-btn:hover {
      color: #ff0000;
    }
  </style></head>
<body>  <div class="nav-bar" id="backButtonContainer">
    <button class="back-button" onclick="goBack()">‚¨Ö Wstecz</button>
  </div>  <h2 id="step-title">Wybierz swoje imiƒô</h2>  <div class="screen active" id="step1">
    <div class="grid" id="workers"></div>
  </div>
  <div class="screen" id="step2">
    <button onclick="fetchProjectsFromSheet()">üîÑ Aktualizuj projekty</button>
    <div class="grid" id="projects"></div>
  </div>
  <div class="screen" id="step3">
    <div class="grid" id="categories"></div>
  </div>
  <div class="screen" id="step4">
    <div class="grid" id="subcategories"></div>
    <h3>Wybierz liczbƒô godzin:</h3>
    <div class="hour-options" id="hourTiles"></div>
  </div>
  <div class="screen" id="step5">
    <h2>Podsumowanie</h2>
    <div id="summary"></div>
    <p><strong>≈ÅƒÖczna liczba godzin:</strong> <span id="totalHours">0</span> h</p>
    <button onclick="addAnotherProject()">Dodaj kolejny projekt</button>
    <button onclick="resetForm()">Zacznij od nowa</button>
    <button onclick="submitData()">Zapisz</button>
  </div>  <script>
    const API_KEY         = "YOUR_NEW_API_KEY";
    const CLIENT_ID       = "YOUR_NEW_CLIENT_ID";
    const SPREADSHEET_ID  = "14t8T8GexDVVlO5v-C1T0VHz94LmM5FRRNg-sXPKh2GE";
    const DISCOVERY_DOCS  = ["https://sheets.googleapis.com/$discovery/rest?version=v4"];
    const SCOPES          = "https://www.googleapis.com/auth/spreadsheets";
    const SHEET_NAME_LOAD = "Projekty";
    const SHEET_NAME_SAVE = "CzasPracy";

    let tokenClient;
    let gapiInited = false;
    let gisInited  = false;

    function gapiLoaded() {
      gapi.load('client', () => gapi.client.init({ apiKey: API_KEY, discoveryDocs: DISCOVERY_DOCS })
        .then(() => { gapiInited = true; }));
    }

    function gisLoaded() {
      tokenClient = google.accounts.oauth2.initTokenClient({
        client_id: CLIENT_ID,
        scope: SCOPES,
        callback: (resp) => {
          if (resp.error) return console.error("Token error:", resp);
          actuallySubmitData();
        }
      });
      gisInited = true;
    }

    const workers = ["Jan","Anna","Kamil","Zuzia","Marek","Ola"];
    const categories = ["Stal","Drewno","Monta≈º","Biuro"];
    const subcategoriesMap = {
      "Stal": ["Spawanie","Ciƒôcie","Szlifowanie","Malowanie proszkowe"],
      "Drewno": ["Szlifowanie","Lakierowanie","Docinanie","Klejenie"],
      "Monta≈º": ["Transport","Instalacja","Dostosowanie","Pomiar na miejscu"],
      "Biuro": ["Mailing","Faktury","Telefon","Projektowanie"]
    };

    let projects = [];
    let state = { worker: null, entries: [] };
    let currentEntry = null;
    let currentStep = 1;

    function showStep(step) {
      document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
      document.getElementById(`step${step}`).classList.add('active');
      const titles = ["Wybierz swoje imiƒô","Wybierz projekt","Wybierz kategoriƒô","Wybierz zadanie","Podsumowanie"];
      document.getElementById('step-title').innerText = titles[step-1];
      document.getElementById('backButtonContainer').style.display = (step===1?'none':'block');
      currentStep = step;
    }

    function goBack() {
      if (currentStep > 1) showStep(currentStep - 1);
    }

    function renderTiles(id, items, cb) {
      const el = document.getElementById(id);
      el.innerHTML = '';
      items.forEach(item => {
        const d = document.createElement('div');
        d.className = 'tile';
        d.innerText = item;
        d.onclick = () => {
          [...el.children].forEach(c => c.classList.remove('selected'));
          d.classList.add('selected');
          cb(item);
        };
        el.appendChild(d);
      });
    }

    function resetForm() {
      state = { worker: null, entries: [] };
      const stored = localStorage.getItem('projekty');
      projects = stored ? JSON.parse(stored) : [];
      showStep(1);
      renderTiles('workers', workers, worker => {
        state.worker = worker;
        showStep(2);
        renderTiles('projects', projects, selectProject);
        addCustomProjectTile();
      });
    }

    function addCustomProjectTile() {
      const t = document.createElement('div');
      t.className = 'tile';
      t.innerText = '+ Dodaj projekt';
      t.onclick = () => {
        const name = prompt("Podaj nazwƒô projektu:");
        if (name) {
          projects.push(name);
          selectProject(name);
        }
      };
      document.getElementById('projects').appendChild(t);
    }

    function selectProject(project) {
      currentEntry = { project, category:null, subcategory:null, hours:0 };
      showStep(3);
      renderTiles('categories', categories, cat => {
        currentEntry.category = cat;
        showStep(4);
        renderTiles('subcategories', subcategoriesMap[cat], sub => {
          currentEntry.subcategory = sub;
          renderHourTiles();
        });
      });
    }

    function renderHourTiles() {
      const c = document.getElementById('hourTiles');
      c.innerHTML = '';
      for (let i=1; i<=16; i++) {
        const d = document.createElement('div');
        d.className = 'tile';
        d.innerText = i;
        d.onclick = () => {
          currentEntry.hours = i;
          state.entries.push({ ...currentEntry });
          showStep(5);
          renderSummary();
        };
        c.appendChild(d);
      }
    }

    function renderSummary() {
      const s = document.getElementById('summary');
      s.innerHTML = '';
      const total = state.entries.reduce((a,b)=>a+b.hours,0);
      const c = document.createElement('div');
      c.className = 'summary-entry-container';
      state.entries.forEach((e,i) => {
        const div = document.createElement('div');
        div.className = 'summary-entry';
        div.innerHTML = `<button class='remove-btn' onclick='removeEntry(${i})'>‚ùå</button><p><strong>${e.project}</strong><br>${e.category}/${e.subcategory} ‚Äì ${e.hours}h</p>`;
        c.appendChild(div);
      });
      s.appendChild(c);
      const totalSpan = document.getElementById('totalHours');
      totalSpan.innerText = total;
      totalSpan.className = `total-hours ${total>9?'red':'green'}`;
    }

    function removeEntry(i) {
      state.entries.splice(i,1);
      renderSummary();
    }

    function addAnotherProject() {
      showStep(2);
      renderTiles('projects', projects, selectProject);
      addCustomProjectTile();
    }

    function submitData() {
      if (!gapiInited || !gisInited) return alert("Trwa inicjalizacja Google API");
      const token = gapi.client.getToken();
      if (!token) {
        tokenClient.requestAccessToken({ prompt: 'consent' });
      } else {
        actuallySubmitData();
      }
    }

    async function actuallySubmitData() {
      const values = state.entries.map(e => [
        new Date().toLocaleString(),
        state.worker,
        e.project,
        e.category,
        e.subcategory,
        e.hours
      ]);
      try {
        await gapi.client.sheets.spreadsheets.values.append({
          spreadsheetId: SPREADSHEET_ID,
          range: `${SHEET_NAME_SAVE}!A1`,
          valueInputOption: 'USER_ENTERED',
          insertDataOption: 'INSERT_ROWS',
          resource: { values }
        });
        alert("Dane zapisane!");
        resetForm();
      } catch (err) {
        alert("Nie uda≈Ço siƒô zapisaƒá danych");
        console.error(err);
      }
    }

    async function fetchProjectsFromSheet() {
      try {
        const res = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/${SHEET_NAME_LOAD}!A2:A?key=${API_KEY}`);
        const data = await res.json();
        if (!data.values) throw new Error("Brak danych");
        projects = data.values.flat().filter(Boolean);
        localStorage.setItem('projekty', JSON.stringify(projects));
        renderTiles('projects', projects, selectProject);
        addCustomProjectTile();
      } catch (err) {
        alert("Nie uda≈Ço siƒô pobraƒá projekt√≥w");
        console.error(err);
      }
    }

    window.addEventListener('load', resetForm);
  </script></body>
</html>